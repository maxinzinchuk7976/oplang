; 0x00-0x08 envoriment
; 0x08-0x10 size
; 0x10-0x18 buffer
; 0x18-0x20 rbp
&fn_tokenize ; rdi envoriment, rsi buffer, rdx size
4851
4857
    c8 2000 00 ; enter 0x20,0
        48893c24 ; mov [rsp], rdi
        4889742410 ; mov [rsp+0x10], rsi
        4889542408 ; mov [rsp+0x08], rdx

        4833c9 ; xor rcx, rcx
        &fn_tokenize_loop
            3b ca ; cmp ecx, rdx
            7d 1*fn_tokenize_end
            8a040e ; mov al, [rcx+rsi]
            488d3d*var_hex_l
            488d15*var_hex_h
            e8*fn_2chrsrch
            488b742410 ; mov rsi, [rsp+0x10]
            488b542408 ; mov rdx, [rsp+0x08]
            488b3c24 ; mov rdi, [rsp]
            751*fn_tokenize_command
                e8*fn_token_hex
                eb1*fn_tokenize_loop
            &fn_tokenize_command
            803c0e25 ; cmp [rcx+rsi], 0x25
            751*fn_tokenize_default
                e8*fn_token_command
                eb1*fn_tokenize_loop
            &fn_tokenize_default
            ffc1 ; inc rcx
        eb 1*fn_tokenize_loop
        &fn_tokenize_end

    c9
485f
4859
c3

&fn_tokenize_string_read 
4853
4857
    488bda ; mov rbx, rdx
    4833ff ; xor rdi,rdi
    3b ca ; cmp ecx, rdx
            7d 1*fn_tokenize_end
    8a040e ; mov al, [rcx+rsi]


    fn_tokenize_string_end
    
485f
485b
c3

%include src/token/hex.op
%include src/token/command.op

&var_hex_l "1234567890abcdef" 00
&var_hex_h "1234567890ABCDEF" 00
&var_delimiters "!#$%&;*} " 0a0900
&var_fillers 200900
